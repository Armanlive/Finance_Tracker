<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finance Tracker</title>
  <style>
    :root {
      --primary: #2563eb;
      --primary-soft: #dbeafe;
      --accent: #f97316;
      --bg: #e5f0ff;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #6b7280;
      --border: #d1d5db;
      --success: #16a34a;
      --danger: #dc2626;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #eff6ff 0, #e5f0ff 60%);
      color: var(--text);
      padding: 10px;
      display:flex;
      justify-content:center;
    }
    .app {
      width:100%;
      max-width:1100px;
    }

    .header {
      background: linear-gradient(135deg, #3b82f6, #60a5fa);
      color:#f9fafb;
      padding:14px 16px;
      border-radius:14px;
      margin-bottom:14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      box-shadow:0 10px 25px rgba(37,99,235,0.35);
    }
    .header-left h1 {
      font-size:1.2rem;
      font-weight:700;
      letter-spacing:0.03em;
    }
    .header-left p {
      font-size:0.75rem;
      opacity:0.9;
      margin-top:2px;
    }
    .header-right {
      text-align:right;
      font-size:0.7rem;
    }
    .pill {
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:2px 8px;
      border-radius:999px;
      background:rgba(15,23,42,0.1);
      font-size:0.7rem;
      font-weight:600;
    }

    .section {
      background: var(--card);
      border-radius:14px;
      padding:14px;
      margin-bottom:12px;
      box-shadow:0 8px 18px rgba(148,163,184,0.35);
      border:1px solid var(--border);
    }
    .section h2 {
      font-size:0.95rem;
      margin-bottom:10px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .section h2 span.icon {
      font-size:1rem;
    }

    .form-grid {
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:10px;
      margin-bottom:10px;
    }
    @media (max-width:700px){
      .form-grid { grid-template-columns:1fr; }
    }
    input, select, button {
      font-size:0.8rem;
    }
    input, select {
      padding:7px 9px;
      border-radius:8px;
      border:1px solid var(--border);
      background:#f9fafb;
      color:var(--text);
      outline:none;
      transition:all 0.15s ease;
    }
    input::placeholder { color:var(--muted); }
    input:focus, select:focus {
      border-color:var(--primary);
      box-shadow:0 0 0 1px rgba(37,99,235,0.25);
      background:#ffffff;
    }

    button {
      border:none;
      border-radius:999px;
      padding:7px 13px;
      cursor:pointer;
      font-weight:600;
      letter-spacing:0.02em;
      display:inline-flex;
      align-items:center;
      gap:6px;
      transition:all 0.15s ease;
    }
    .btn-primary {
      background:linear-gradient(135deg,#3b82f6,#2563eb);
      color:#f9fafb;
    }
    .btn-primary:hover { transform:translateY(-1px); box-shadow:0 8px 18px rgba(37,99,235,0.4); }
    .btn-soft {
      background:var(--primary-soft);
      color:var(--primary);
      border:1px solid #bfdbfe;
    }
    .btn-soft:hover { background:#bfdbfe; }
    .btn-danger {
      background:#fee2e2;
      color:var(--danger);
      border:1px solid #fecaca;
      padding:4px 9px;
      font-size:0.7rem;
      border-radius:999px;
    }
    .btn-danger:hover { background:#fecaca; }
    .btn-xs {
      padding:3px 7px;
      font-size:0.7rem;
    }

    .filters {
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-bottom:10px;
      align-items:center;
    }
    .filters select { min-width:135px; }

    .summary {
      display:grid;
      grid-template-columns:repeat(4,minmax(0,1fr));
      gap:8px;
    }
    @media (max-width:700px){
      .summary { grid-template-columns:repeat(2,minmax(0,1fr)); }
    }
    .stat {
      padding:10px 10px;
      border-radius:10px;
      background:linear-gradient(145deg,#eff6ff,#ffffff);
      border:1px solid #dbeafe;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .stat-label {
      font-size:0.7rem;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:0.06em;
    }
    .stat-value {
      font-size:0.9rem;
      font-weight:700;
      color:#111827;
    }
    .stat-tag {
      font-size:0.7rem;
      color:var(--success);
    }
    .stat-tag.negative { color:var(--danger); }

    .due-card {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:7px 9px;
      border-radius:9px;
      background:#eff6ff;
      border:1px solid #dbeafe;
      margin-bottom:6px;
      font-size:0.75rem;
    }
    .due-main span { display:block; }
    .due-desc { font-weight:600; color:#111827; }
    .due-meta { color:var(--muted); font-size:0.7rem; }

    .table-wrapper {
      width:100%;
      overflow-x:auto;
      border-radius:10px;
      border:1px solid #dbeafe;
      background:#f9fafb;
    }
    table {
      width:100%;
      border-collapse:collapse;
      font-size:0.75rem;
    }
    th, td {
      padding:7px 8px;
      text-align:left;
      border-bottom:1px solid #e5e7eb;
      white-space:nowrap;
    }
    th {
      background:#eef2ff;
      color:#4b5563;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.06em;
      font-size:0.68rem;
      position:sticky;
      top:0;
      z-index:1;
    }
    tr:nth-child(even) { background:#f9fafb; }
    tr:hover td { background:#e0f2fe; }

    .chip-type {
      padding:2px 7px;
      border-radius:999px;
      font-size:0.65rem;
      font-weight:600;
    }
    .chip-income { background:#dcfce7; color:#166534; }
    .chip-expense { background:#fee2e2; color:#b91c1c; }
    .chip-invest { background:#dbeafe; color:#1d4ed8; }

    p { font-size:0.78rem; }
    .muted { color:var(--muted); }

    .empty-state {
      font-size:0.78rem;
      color:var(--muted);
      padding:6px 2px;
    }
  </style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="header-left">
      <h1>Finance Tracker</h1>
      <p>Income ‚Ä¢ Expenses ‚Ä¢ Investments ‚Ä¢ Repayments</p>
    </div>
    <div class="header-right">
      <div class="pill">üìÖ <span id="todayText"></span></div><br>
      <span class="muted">Local ¬∑ Offline ¬∑ Private</span>
    </div>
  </div>

  <div class="section">
    <h2><span class="icon">‚ûï</span> Add Entry</h2>
    <div class="form-grid">
      <input type="date" id="date" required>
      <select id="type" required>
        <option value="">Type</option>
        <option value="Income">Income</option>
        <option value="Expense">Expense</option>
        <option value="Share">Share Market</option>
        <option value="MF">Mutual Fund</option>
        <option value="LIC">LIC</option>
        <option value="OtherInv">Other Investments</option>
      </select>
      <input type="number" id="amount" placeholder="Amount (‚Çπ)" required>
      <input type="text" id="desc" placeholder="Description">
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button class="btn-primary" onclick="saveEntry()">Save Entry</button>
      <button class="btn-soft" onclick="exportCSV()">üìä Export CSV</button>
    </div>
  </div>

  <div class="section">
    <h2><span class="icon">üìÖ</span> Add Repayment</h2>
    <div class="form-grid">
      <input type="text" id="dueDesc" placeholder="EMI / Loan Name">
      <input type="date" id="dueDate" required>
      <input type="number" id="dueAmount" placeholder="Amount (‚Çπ)" required>
    </div>
    <button class="btn-primary" onclick="addDue()">Save Due</button>
  </div>

  <div class="section" style="padding-bottom:10px;">
    <div class="filters">
      <select id="monthFilter" onchange="renderAll()">
        <option value="">All Months</option>
      </select>
      <select id="typeFilter" onchange="renderAll()">
        <option value="">All Types</option>
        <option value="Income">Income</option>
        <option value="Expense">Expense</option>
        <option value="Share">Share</option>
        <option value="MF">MF</option>
        <option value="LIC">LIC</option>
        <option value="OtherInv">Other Investments</option>
      </select>
      <button class="btn-danger" onclick="deleteAll()">üóë Delete All</button>
    </div>
  </div>

  <div class="section">
    <h2><span class="icon">üìä</span> Monthly Snapshot</h2>
    <div class="summary" id="summary"></div>
  </div>

  <div class="section">
    <h2><span class="icon">‚ö†Ô∏è</span> Upcoming Dues</h2>
    <div id="duesList"></div>
  </div>

  <div class="section">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
      <h2><span class="icon">üìã</span> All Entries</h2>
      <span class="muted" id="entriesCount"></span>
    </div>
    <div id="entries"></div>
  </div>
</div>

<script>
  let entries = JSON.parse(localStorage.getItem('financeEntries')) || [];
  let dues = JSON.parse(localStorage.getItem('financeDues')) || [];
  let editingId = null;

  function saveData() {
    localStorage.setItem('financeEntries', JSON.stringify(entries));
    localStorage.setItem('financeDues', JSON.stringify(dues));
  }

  function saveEntry() {
    const date = document.getElementById('date').value;
    const type = document.getElementById('type').value;
    const amount = parseFloat(document.getElementById('amount').value);
    const desc = document.getElementById('desc').value;
    if (!date || !type || !amount) return alert('Please fill Date, Type and Amount.');

    if (editingId) {
      entries = entries.map(e => e.id === editingId ? { ...e, date, type, amount, desc } : e);
      editingId = null;
    } else {
      entries.push({ id: Date.now(), date, type, amount, desc });
    }

    saveData();
    document.getElementById('date').value = '';
    document.getElementById('type').value = '';
    document.getElementById('amount').value = '';
    document.getElementById('desc').value = '';
    renderAll();
  }

  function addDue() {
    const desc = document.getElementById('dueDesc').value;
    const date = document.getElementById('dueDate').value;
    const amount = parseFloat(document.getElementById('dueAmount').value);
    if (!desc || !date || !amount) return alert('Please fill all due fields.');
    dues.push({ id: Date.now(), desc, date, amount });
    saveData();
    document.getElementById('dueDesc').value = '';
    document.getElementById('dueDate').value = '';
    document.getElementById('dueAmount').value = '';
    renderDues();
  }

  function getMonthYear(d) { return d.slice(0,7); }

  function filterEntries() {
    const monthFilter = document.getElementById('monthFilter').value;
    const typeFilter = document.getElementById('typeFilter').value;
    return entries.filter(e =>
      (!monthFilter || getMonthYear(e.date) === monthFilter) &&
      (!typeFilter || e.type === typeFilter)
    );
  }

  function renderSummary(filtered) {
    const income = filtered.filter(e => e.type === 'Income').reduce((sum, e) => sum + e.amount, 0);
    const expense = filtered.filter(e => e.type === 'Expense').reduce((sum, e) => sum + e.amount, 0);
    const investment = filtered
      .filter(e => ['Share','MF','LIC','OtherInv'].includes(e.type))
      .reduce((sum, e) => sum + e.amount, 0);
    const balance = income - expense;
    const balancePositive = balance >= 0;

    document.getElementById('summary').innerHTML = `
      <div class="stat">
        <div class="stat-label">Income</div>
        <div class="stat-value">‚Çπ${income.toLocaleString()}</div>
        <div class="stat-tag">Cash In</div>
      </div>
      <div class="stat">
        <div class="stat-label">Expense</div>
        <div class="stat-value">‚Çπ${expense.toLocaleString()}</div>
        <div class="stat-tag negative">Cash Out</div>
      </div>
      <div class="stat">
        <div class="stat-label">Investments</div>
        <div class="stat-value">‚Çπ${investment.toLocaleString()}</div>
        <div class="stat-tag">Share ‚Ä¢ MF ‚Ä¢ LIC ‚Ä¢ Other</div>
      </div>
      <div class="stat">
        <div class="stat-label">Balance</div>
        <div class="stat-value">‚Çπ${balance.toLocaleString()}</div>
        <div class="stat-tag ${balancePositive ? '' : 'negative'}">${balancePositive ? 'Surplus' : 'Deficit'}</div>
      </div>
    `;
  }

  function renderEntries(filtered) {
    const countSpan = document.getElementById('entriesCount');
    countSpan.textContent = filtered.length ? `${filtered.length} entries` : 'No entries';

    if (!filtered.length) {
      document.getElementById('entries').innerHTML = '<p class="empty-state">No entries for selected filters.</p>';
      return;
    }

    let rows = '';
    filtered.forEach(e => {
      let chipClass = 'chip-invest';
      if (e.type === 'Income') chipClass = 'chip-income';
      else if (e.type === 'Expense') chipClass = 'chip-expense';

      const typeLabel =
        e.type === 'OtherInv' ? 'Other Investments' :
        e.type;

      rows += `
        <tr>
          <td>${new Date(e.date).toLocaleDateString('en-IN')}</td>
          <td><span class="chip-type ${chipClass}">${typeLabel}</span></td>
          <td>‚Çπ${e.amount.toLocaleString()}</td>
          <td>${e.desc || '-'}</td>
          <td>
            <button class="btn-soft btn-xs" onclick="editEntry(${e.id})">Edit</button>
            <button class="btn-danger btn-xs" onclick="deleteEntry(${e.id})">Delete</button>
          </td>
        </tr>
      `;
    });

    document.getElementById('entries').innerHTML = `
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Type</th>
              <th>Amount</th>
              <th>Description</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      </div>
    `;
  }

  function editEntry(id) {
    const entry = entries.find(e => e.id === id);
    if (!entry) return;
    editingId = id;
    document.getElementById('date').value = entry.date;
    document.getElementById('type').value = entry.type;
    document.getElementById('amount').value = entry.amount;
    document.getElementById('desc').value = entry.desc || '';
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function renderDues() {
    const today = new Date().toISOString().slice(0,10);
    const upcoming = dues
      .filter(d => d.date >= today)
      .sort((a,b) => new Date(a.date) - new Date(b.date));

    if (!upcoming.length) {
      document.getElementById('duesList').innerHTML = '<p class="empty-state">No upcoming dues.</p>';
      return;
    }

    let html = '';
    upcoming.forEach(d => {
      html += `
        <div class="due-card">
          <div class="due-main">
            <span class="due-desc">${d.desc}</span>
            <span class="due-meta">
              ‚Çπ${d.amount.toLocaleString()} ‚Ä¢ ${new Date(d.date).toLocaleDateString('en-IN')}
            </span>
          </div>
          <button class="btn-danger btn-xs" onclick="deleteDue(${d.id})">Delete</button>
        </div>
      `;
    });
    document.getElementById('duesList').innerHTML = html;
  }

  function renderAll() {
    const filtered = filterEntries();
    renderSummary(filtered);
    renderEntries(filtered);
    populateFilters();
  }

  function populateFilters() {
    const months = [...new Set(entries.map(getMonthYear))].filter(Boolean).sort().reverse();
    const monthSel = document.getElementById('monthFilter');
    const currentVal = monthSel.value;
    monthSel.innerHTML = '<option value="">All Months</option>' +
      months.map(m => {
        const label = new Date(m+'-01').toLocaleDateString('en-IN', {month:'short', year:'numeric'});
        return `<option value="${m}">${label}</option>`;
      }).join('');
    if (currentVal) monthSel.value = currentVal;
  }

  function deleteEntry(id) {
    if (!confirm('Delete this entry?')) return;
    entries = entries.filter(e => e.id !== id);
    saveData();
    renderAll();
  }

  function deleteDue(id) {
    if (!confirm('Delete this due?')) return;
    dues = dues.filter(d => d.id !== id);
    saveData();
    renderDues();
  }

  function deleteAll() {
    if (confirm('Delete all entries and dues?')) {
      entries = [];
      dues = [];
      saveData();
      renderAll();
      renderDues();
    }
  }

  function exportCSV() {
    const filtered = filterEntries();
    if (!filtered.length) return alert('No data to export for selected filters.');
    const csv = 'Date,Type,Amount,Desc\n' +
      filtered.map(e => `${e.date},${e.type},${e.amount},"${(e.desc || '').replace(/"/g,'""')}"`).join('\n');
    const blob = new Blob([csv], {type: 'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `finance-${new Date().toISOString().slice(0,10)}.csv`;
    a.click();
  }

  document.addEventListener('DOMContentLoaded', () => {
    const today = new Date();
    document.getElementById('todayText').textContent =
      today.toLocaleDateString('en-IN', { day:'2-digit', month:'short', year:'numeric' });
    const d = new Date().toISOString().slice(0,10);
    document.getElementById('date').value = d;
    document.getElementById('dueDate').value = d;
    populateFilters();
    renderAll();
    renderDues();
  });
</script>
</body>
</html>
